<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Server Initialization and Main.rs - Building Apps with Rust</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Preamble</li><li class="chapter-item expanded "><a href="../../read_me_first.html"><strong aria-hidden="true">1.</strong> Notice to Reader</a></li><li class="chapter-item expanded "><a href="../../preface.html"><strong aria-hidden="true">2.</strong> Preface</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Acknowledgements</div></li><li class="chapter-item expanded "><a href="../../about.html"><strong aria-hidden="true">4.</strong> About this Book</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> About the Author</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> If you get stuck or lose steam</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Introductions</li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> What it is</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Why it's worth it</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> Why it's hard</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.4.</strong> Programmer Thinking</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Languages</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Meaning and Interpretation</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Architectures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> What is architecture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> How your computer works</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> How the web works</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.4.</strong> The frontend-backend divide</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.5.</strong> General application architecture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.6.</strong> Trade-offs between WASM and JavaScript</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Tools and Languages</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> Web browsers</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> HTML</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.3.</strong> Bash and the terminal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.4.</strong> Rust</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.5.</strong> Trunk</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.6.</strong> Cargo Leptos</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Other Resources</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../intro/other_resources/rust.html"><strong aria-hidden="true">11.1.</strong> Rust</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Getting Started with Rust and Leptos</li><li class="chapter-item expanded "><a href="../../getting_started/setup.html"><strong aria-hidden="true">12.</strong> Setup</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Architecture</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">13.1.</strong> Leptos Components - #[component]</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.2.</strong> Signals (reactive values) - create_signal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.3.</strong> Effects (side effects) - create_effect</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Generting UI</li><li class="chapter-item expanded "><a href="../../client/summary.html"><strong aria-hidden="true">14.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">15.1.</strong> Trunk</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><a href="../../getting_started/html_intro.html"><strong aria-hidden="true">17.</strong> HTML</a></li><li class="chapter-item expanded "><a href="../../getting_started/view_macro_html.html"><strong aria-hidden="true">18.</strong> The view! macro</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_intro.html"><strong aria-hidden="true">19.</strong> Leptos Components</a></li><li class="chapter-item expanded "><a href="../../ui/view_macro_variables.html"><strong aria-hidden="true">20.</strong> Variables and the view! macro</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_properties.html"><strong aria-hidden="true">21.</strong> Component properties</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_dynamic_content_separation.html"><strong aria-hidden="true">22.</strong> Component dynamic content separation</a></li><li class="chapter-item expanded "><a href="../../ui/loops_and_the_for_view_macro_tag.html"><strong aria-hidden="true">23.</strong> Loops and the &lt;For /&gt; view! macro tag</a></li><li class="chapter-item expanded "><a href="../../ui/conditional_display_and_the_show_macro.html"><strong aria-hidden="true">24.</strong> Conditional display and the &lt;Show&gt; view! macro tag</a></li><li class="chapter-item expanded "><a href="../../ui/tables_and_data_sets.html"><strong aria-hidden="true">25.</strong> Tables and data sets</a></li><li class="chapter-item expanded "><a href="../../ui/reserved_tags.html"><strong aria-hidden="true">26.</strong> Reserved Tags</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Client Side</li><li class="chapter-item expanded "><a href="../../client/summary.html"><strong aria-hidden="true">27.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">28.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">28.1.</strong> Trunk</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">29.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">30.</strong> Responding to Events</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/responding/leptos_component_logging_events.html"><strong aria-hidden="true">30.1.</strong> Witnessing events</a></li><li class="chapter-item expanded "><a href="../../client/responding/leptos_component_update_from_event.html"><strong aria-hidden="true">30.2.</strong> Reacting to events with event handlers</a></li><li class="chapter-item expanded "><a href="../../client/responding/event_handlers_as_props.html"><strong aria-hidden="true">30.3.</strong> Event handers as props</a></li><li class="chapter-item expanded "><a href="../../client/responding/event_bubbling_and_signal_generics.html"><strong aria-hidden="true">30.4.</strong> Event Bubbling and Signal Generics</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">30.5.</strong> Preventing bubbling and default event behaviours </div></li><li class="chapter-item expanded "><a href="../../client/responding/custom_events.html"><strong aria-hidden="true">30.6.</strong> Custom Events</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data.html"><strong aria-hidden="true">30.7.</strong> Custom Event Data</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_module.html"><strong aria-hidden="true">30.8.</strong> Custom Event Module</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_module_with_data.html"><strong aria-hidden="true">30.9.</strong> Custom Event Module with Data</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data_with_signals_and_effects.html"><strong aria-hidden="true">30.10.</strong> Custom Event Data with Signals and Effects</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data_with_signals_and_effects_part2.html"><strong aria-hidden="true">30.11.</strong> Custom Event Data with Signals and Effects - Part 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">31.</strong> Sending Data</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/responding/forms.html"><strong aria-hidden="true">31.1.</strong> Forms</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">31.2.</strong> Acton Forms</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">32.</strong> Sending and Receiving Data</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">32.1.</strong> Fetch</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">32.2.</strong> Web Socket</div></li></ol></li><li class="chapter-item expanded "><a href="../../client/store_data/summary.html"><strong aria-hidden="true">33.</strong> Saving/Persisting Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/store_data/web_storage.html"><strong aria-hidden="true">33.1.</strong> Local Storage</a></li><li class="chapter-item expanded "><a href="../../client/store_data/cookies.html"><strong aria-hidden="true">33.2.</strong> Cookies</a></li><li class="chapter-item expanded "><a href="../../client/store_data/indexeddb.html"><strong aria-hidden="true">33.3.</strong> IndexedDB</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Server Side</li><li class="chapter-item expanded "><a href="../../server/summary.html"><strong aria-hidden="true">34.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">35.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/cargo_leptos/summary.html"><strong aria-hidden="true">35.1.</strong> Cargo Leptos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/cargo_leptos/setup.html"><strong aria-hidden="true">35.1.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/file_structure.html"><strong aria-hidden="true">35.1.2.</strong> File Structure</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/config.html"><strong aria-hidden="true">35.1.3.</strong> Config</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/overview_main.html" class="active"><strong aria-hidden="true">35.1.4.</strong> Server Initialization and Main.rs</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/overview_app.html"><strong aria-hidden="true">35.1.5.</strong> Leptos app main component and app.rs</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/leptos_meta.html"><strong aria-hidden="true">35.1.6.</strong> Leptos_meta</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/leptos_router.html"><strong aria-hidden="true">35.1.7.</strong> Leptos_router</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">36.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.</strong> Responding to Requests</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/responding/get_method_forms.html"><strong aria-hidden="true">37.1.</strong> Get Method Forms</a></li><li class="chapter-item expanded "><a href="../../server/responding/post_method_forms.html"><strong aria-hidden="true">37.2.</strong> Post Method Forms</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.3.</strong> Accessing Request Data</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.</strong> Responding Parts</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.1.</strong> Headers</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.2.</strong> Cookies</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.3.</strong> Body</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.5.</strong> HTML Requests - Routes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.6.</strong> Data Requests - Server Functions</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.7.</strong> Behaviour Request - Server Actions</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">38.</strong> Client Server Communication</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/server_client_communication/server_functions.html"><strong aria-hidden="true">38.1.</strong> Server Functions</a></li><li class="chapter-item expanded "><a href="../../server/server_client_communication/transition.html"><strong aria-hidden="true">38.2.</strong> &lt;Transition&gt;</a></li><li class="chapter-item expanded "><a href="../../server/server_client_communication/action_form.html"><strong aria-hidden="true">38.3.</strong> &lt;ActionForm&gt;</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">38.4.</strong> Web Sockets</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">39.</strong> Saving/Persisting Data</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Architecture</li><li class="chapter-item expanded "><a href="../../architecture/scope_and_runtime.html"><strong aria-hidden="true">40.</strong> Scope and Runtime</a></li><li class="chapter-item expanded "><a href="../../architecture/passing_data_around.html"><strong aria-hidden="true">41.</strong> Passing data around</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Deployment</li><li class="chapter-item expanded "><div><strong aria-hidden="true">42.</strong> Render.com</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">43.</strong> Fly.io</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">44.</strong> Cloudflare Workers</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Desktop Applications</li><li class="chapter-item expanded "><div><strong aria-hidden="true">45.</strong> Tauri</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">46.</strong> TUI</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Tutorial Projects</li><li class="chapter-item expanded "><div><strong aria-hidden="true">47.</strong> Blog</div></li><li class="chapter-item expanded "><a href="../../tutorial_projects/initiative_tracker/summary.html"><strong aria-hidden="true">48.</strong> RPG Initiative Tracker</a></li><li class="chapter-item expanded "><a href="../../tutorial_projects/chat/summary.html"><strong aria-hidden="true">49.</strong> Chat</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Quick Reference</li><li class="chapter-item expanded "><a href="../../quick_reference/rust/structuring_applictions.html"><strong aria-hidden="true">50.</strong> Structuring Applications</a></li><li class="chapter-item expanded "><a href="../../quick_reference/rust/documenting_applictions.html"><strong aria-hidden="true">51.</strong> Documenting Applications</a></li><li class="chapter-item expanded "><a href="../../quick_reference/rust/testing_applictions.html"><strong aria-hidden="true">52.</strong> Testing Applications</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Recipes</li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div><strong aria-hidden="true">53.</strong> Common Application Behaviours</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">53.1.</strong> Form Validation</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">54.</strong> Common Design Patterns</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">54.1.</strong> Event Sourcing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">55.</strong> Common Problems and Concerns</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">55.1.</strong> Quality</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">55.1.1.</strong> UI Response Time</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">55.1.2.</strong> Bundle Size</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">55.1.3.</strong> Partial Hydration</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">55.2.</strong> Consistency</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">55.2.1.</strong> Offline Support and Data Sync</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">55.2.2.</strong> Observability and Logging</div></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Building Apps with Rust</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cargo-leptos-mainrs"><a class="header" href="#cargo-leptos-mainrs">Cargo Leptos <code>main.rs</code></a></h1>
<p>The server is run from  <code>src/main.rs</code> .  In this file we'll see macros like <code>#[cfg(feature = &quot;ssr&quot;)]</code>. These macros tell Rust to only include the following function if the &quot;ssr&quot; feature is enabled. SSR stands for &quot;Server Side Rendering&quot;. This is what our web server is doing. You may have noticed that the ready message for Cargo Leptos has &quot;--feature=ssr&quot; in it. </p>
<h3 id="server-only-use-statements"><a class="header" href="#server-only-use-statements">Server only use statements</a></h3>
<p>At the very top we'll see a set of use statements wrapped in a macro that roughly reads as &quot;if ssr is enabled, do the following.&quot;</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>cfg_if::cfg_if! { if #[cfg(feature = &quot;ssr&quot;)] {
	//...
}
<span class="boring">}</span></code></pre></pre>
<p>Here we're including the external crates required for the Axum web server. </p>
<h3 id="server-only-main-function"><a class="header" href="#server-only-main-function">Server only main function</a></h3>
<p>Next we'll see our main function. Above it we have a feature macro which only allows the compiler to see this function if the ssr feature flag is set.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(feature = &quot;ssr&quot;)]
<span class="boring">}</span></code></pre></pre>
<h3 id="async-server-only-main-function"><a class="header" href="#async-server-only-main-function">Async server only main function</a></h3>
<p>Then we have another curious macro:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[tokio::main]
<span class="boring">}</span></code></pre></pre>
<p>Tokio is an asynchronous (async) runtime for Rust. This macro initializes tokio as the software thats will handle the implementation of functions using the async keyword.</p>
<p>To make sense of this we'll need to go over the difference between synchronous and asynchronous code. Code that is synchronous runs sequentially. One piece of code runs after the next, in order. This is very predictable and easy to reason about because there is a linear timeline. There are problems with synchronous code though. It can only do one thing at a time. If we had a web server we would only be able to handle one response at a time. What we would like to do is handle responses as they come in, whenever they come in. Responses should be handled out of sync, or async. ^.^</p>
<p>Thinking about synchronous and asynchronous code involves a bit of a paradigm shift. A change in the way you think about code.</p>
<p>Here's an example of a synchronous process written as simple instructions:</p>
<pre><code>Count to five and make a sandwich
Eat the sandwich when it's ready
</code></pre>
<p>In synchronous code the result of these instructions would look like this:</p>
<pre><code>1,2,3,4,5
(started making a sandwich)
(finished making a sandwich)
(consumed the sandich)
</code></pre>
<p>Asynchronous code would yield something more like this:</p>
<pre><code>1,
(started making a sandwich)
2,
3,
4,
(finished making a sandwich)
(consumed the sandwich)
5,
</code></pre>
<p>This result occurs because these tasks are running in parallel. We're counting AND making the sandwich, asynchronously.</p>
<p>In many languages we would call these <strong>promises.</strong> We don't have a sandwich, but we have a stand in which is a promisory value that it will become a sandwich. In rust, we call these <em>Futures.</em> The result of calling an async function is a struct that implements the <a href="https://docs.rs/futures/0.1.31/futures/future/trait.Future.html">Futures trait</a>. Which is to say, a struct that has a set of methods we are guaranteed to be able to call. </p>
<p>Two approaches are commonly used when dealing with asynchronous code.</p>
<ol>
<li><strong>Callbacks:</strong> We don't know when an async function will conclude. In order to use the data that results from it, or to do something upon completion, we provide a callback. A function to be run on completion/failure/resolution of the async function. This is done through the <a href="https://docs.rs/futures/0.1.31/futures/future/trait.Future.html#method.then"><code>then()</code></a> method, which is part of the Futures trait. </li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Get a copy of me
let hungry_me = get_the_author();
// imagine that make_sandwich was an async function
make_sandwich() 
	.then(      
		move |sandwich| hungry_me.eat(sandwich) 
	);	
// This line will run while the sandwich is being made
<span class="boring">}</span></code></pre></pre>
<ol start="2">
<li><strong>Awaiting:</strong> We can wait for the async function to complete, pausing this part of the program and letting it resume when it's complete. This allows async code to read as synchronous code. Awaiting happens inside other async tasks. Now <code>om_nom_nom</code> can run and take the time it needs without holding up the rest of the application.</li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn om_nom_nom() {
	let hungry_me = get_the_author();
	let sandwich = make_sandwich().await();
	hungry_me.eat(sandwich);
}
<span class="boring">}</span></code></pre></pre>
<h4 id="why-do-we-need-tokio"><a class="header" href="#why-do-we-need-tokio">Why do we need tokio?</a></h4>
<p>There is an async runtime built into the browser which can be taken for granted when working on the front end in Javascript. The needs of how async tasks are handled for a systems language are varied. If the Rust language developers got it wrong, we'd be stuck with it. To safe this they've said, &quot;Hey, we're going to tell you which syntax to use when you write async code. We'll tell you which methods you can call on Futures with the Trait specification, but we're not going to tell you how it'll work. You'll need to bring your own implementation.&quot; This gives us huge freedom because we can decide how async code actually runs! Tokio is handling the implementations of those traits for us. Very rad.</p>
<h3 id="inside-the-server-main-function"><a class="header" href="#inside-the-server-main-function">Inside the server main function</a></h3>
<p>We'll see a few main components inside the main function</p>
<ol>
<li>Initialization of a logger that gives nicely formatted and timestamped console log output.</li>
<li>Setup of the server's config</li>
<li>Creation of our application</li>
<li>Injection of our application into the axum server so that our app will be used to handle the processing of requests to generate responses. Axum handles the nitty gritty of preparing the requests and formatting the final parts of the response so that we can focus on our application specific components such as updating state and rendering ui.</li>
</ol>
<h4 id="1-simple-logger"><a class="header" href="#1-simple-logger">1) Simple Logger</a></h4>
<p>Simple logger allows us to call nice log messages like this:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>log!(&quot;listening on http://{}&quot;, &amp;addr);
<span class="boring">}</span></code></pre></pre>
<h4 id="2-server-config"><a class="header" href="#2-server-config">2) Server config</a></h4>
<p>We're calling <code>get_configuration()</code> with an argument of <code>None</code> which will load the configuration from settings from Cargo Leptos. We could also replace <code>None</code> with <code>Some(&quot;./cargo.toml&quot;)</code> to load the settings we've established in our <code>cargo.toml</code>. In the example you'll see them listed under the <code>[package.metadata.leptos]</code> heading.</p>
<p><code>leptos_options</code> is a property on the <code>conf</code> that was setup using the <code>cargo.toml</code> settings. We need to pass the options to a few places so we've assigned it to it's own variable. We've also cloned the site address so that we can pass it around without it being a reference into a struct. If we didn't clone it, Rust would likely complain about leptos_options having moved but we have a reference to it which is going elsewhere (like in the log message and used to bind the server to the address).</p>
<p>We generate the routes list from a view which contains our App Leptos component. If you peek into <code>/src/app.rs</code> you'll see the declarative way routes are listed. We'll get into that later. Just know that this function is reading our declarative routes and turning them into routes that the web server (Axum) can use.</p>
<h4 id="3-setup-our-app-as-a-service-for-axum"><a class="header" href="#3-setup-our-app-as-a-service-for-axum">3) Setup our app as a service for axum</a></h4>
<p>Our app will be a service which axum calls upon to handle and provide responses to requests. Axum's <code>Router</code> is the starting block for building this out. We initialize a new router. Then we append a route on it which is specially designed to work with Leptos. We say that axum will have routes for <code>api/function_name</code> which uses the function name to connect with our Leptos server functions. This is achieved through the <code>leptos_axum</code> integration module's <code>handle_server_fns</code>.</p>
<p>The <code>leptos_axum</code> integration adds a method to the <code>axum::Router</code> struct which allows us to configure the axum::Router with leptos config. That's what's happening here:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>.leptos_routes(leptos_options.clone(), routes, |cx| view! { cx, &lt;App/&gt; })
<span class="boring">}</span></code></pre></pre>
<p>The <code>fallback</code> allows us to serve the <code>error_template</code> component from  <code>/src/error_template.rs</code> if a route couldn't be found to serve. The internals of fallback are also responsible for serving static files like WASM and JS, because those aren't routes either.</p>
<p>And finally, <code>layer</code> allows us to create an extension with an <code>arc</code> (Asynchronous Reference Counted) value. The extension allows us to create something that all responses can see. The <code>arc</code> allows us to make it safe to pass the data across threads (required for axum). In the <code>arc</code> we place the <code>leptos_options</code>. </p>
<h4 id="4-start-the-web-server"><a class="header" href="#4-start-the-web-server">4) Start the web server</a></h4>
<p>In this last step we bind the address to the axum server and tell it to serve our app, which we convert into a service for axum to use. We await it so that it continues to run until the process shuts down. This prevents the main function from hitting the end of its scope and concluding the applications running.</p>
<h3 id="client-side-main-function"><a class="header" href="#client-side-main-function">Client side main function</a></h3>
<p>At the bottom of main.rs you'll see the following:</p>
<pre><pre class="playground"><code class="language-rust">#[cfg(not(feature = &quot;ssr&quot;))]  
pub fn main() {  
    // no client-side main function    
    // unless we want this to work with 
    // e.g., Trunk for pure client-side testing    
	// see lib.rs for hydration function instead
}</code></pre></pre>
<p>The following macro tells Rust to include this function if we're not in ssr (server) mode, which is denoted by the ssr feature being disabled. That would occur if we're compiling for the client side. In this setup we will only be looking at server side handling/routing.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../server/cargo_leptos/config.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../server/cargo_leptos/overview_app.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../server/cargo_leptos/config.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../server/cargo_leptos/overview_app.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
