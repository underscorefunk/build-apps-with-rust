<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Server Functions - Building Apps with Rust</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Preamble</li><li class="chapter-item expanded "><a href="../../read_me_first.html"><strong aria-hidden="true">1.</strong> Notice to Reader</a></li><li class="chapter-item expanded "><a href="../../preface.html"><strong aria-hidden="true">2.</strong> Preface</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Acknowledgements</div></li><li class="chapter-item expanded "><a href="../../about.html"><strong aria-hidden="true">4.</strong> About this Book</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> About the Author</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> If you get stuck or lose steam</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Introductions</li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> What it is</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Why it's worth it</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> Why it's hard</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.4.</strong> Programmer Thinking</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Languages</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Meaning and Interpretation</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Architectures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> What is architecture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> How your computer works</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> How the web works</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.4.</strong> The frontend-backend divide</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.5.</strong> General application architecture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.6.</strong> Trade-offs between WASM and JavaScript</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Tools and Languages</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> Web browsers</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> HTML</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.3.</strong> Bash and the terminal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.4.</strong> Rust</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.5.</strong> Trunk</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.6.</strong> Cargo Leptos</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Other Resources</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../intro/other_resources/rust.html"><strong aria-hidden="true">11.1.</strong> Rust</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Getting Started with Rust and Leptos</li><li class="chapter-item expanded "><a href="../../getting_started/setup.html"><strong aria-hidden="true">12.</strong> Setup</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Architecture</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">13.1.</strong> Leptos Components - #[component]</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.2.</strong> Signals (reactive values) - create_signal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.3.</strong> Effects (side effects) - create_effect</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Generting UI</li><li class="chapter-item expanded "><a href="../../client/summary.html"><strong aria-hidden="true">14.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">15.1.</strong> Trunk</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><a href="../../getting_started/html_intro.html"><strong aria-hidden="true">17.</strong> HTML</a></li><li class="chapter-item expanded "><a href="../../getting_started/view_macro_html.html"><strong aria-hidden="true">18.</strong> The view! macro</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_intro.html"><strong aria-hidden="true">19.</strong> Leptos Components</a></li><li class="chapter-item expanded "><a href="../../ui/view_macro_variables.html"><strong aria-hidden="true">20.</strong> Variables and the view! macro</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_properties.html"><strong aria-hidden="true">21.</strong> Component properties</a></li><li class="chapter-item expanded "><a href="../../ui/leptos_component_dynamic_content_separation.html"><strong aria-hidden="true">22.</strong> Component dynamic content separation</a></li><li class="chapter-item expanded "><a href="../../ui/loops_and_the_for_view_macro_tag.html"><strong aria-hidden="true">23.</strong> Loops and the &lt;For /&gt; view! macro tag</a></li><li class="chapter-item expanded "><a href="../../ui/conditional_display_and_the_show_macro.html"><strong aria-hidden="true">24.</strong> Conditional display and the &lt;Show&gt; view! macro tag</a></li><li class="chapter-item expanded "><a href="../../ui/tables_and_data_sets.html"><strong aria-hidden="true">25.</strong> Tables and data sets</a></li><li class="chapter-item expanded "><a href="../../ui/reserved_tags.html"><strong aria-hidden="true">26.</strong> Reserved Tags</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Client Side</li><li class="chapter-item expanded "><a href="../../client/summary.html"><strong aria-hidden="true">27.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">28.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">28.1.</strong> Trunk</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">29.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">30.</strong> Responding to Events</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/responding/leptos_component_logging_events.html"><strong aria-hidden="true">30.1.</strong> Witnessing events</a></li><li class="chapter-item expanded "><a href="../../client/responding/leptos_component_update_from_event.html"><strong aria-hidden="true">30.2.</strong> Reacting to events with event handlers</a></li><li class="chapter-item expanded "><a href="../../client/responding/event_handlers_as_props.html"><strong aria-hidden="true">30.3.</strong> Event handers as props</a></li><li class="chapter-item expanded "><a href="../../client/responding/event_bubbling_and_signal_generics.html"><strong aria-hidden="true">30.4.</strong> Event Bubbling and Signal Generics</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">30.5.</strong> Preventing bubbling and default event behaviours </div></li><li class="chapter-item expanded "><a href="../../client/responding/custom_events.html"><strong aria-hidden="true">30.6.</strong> Custom Events</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data.html"><strong aria-hidden="true">30.7.</strong> Custom Event Data</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_module.html"><strong aria-hidden="true">30.8.</strong> Custom Event Module</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_module_with_data.html"><strong aria-hidden="true">30.9.</strong> Custom Event Module with Data</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data_with_signals_and_effects.html"><strong aria-hidden="true">30.10.</strong> Custom Event Data with Signals and Effects</a></li><li class="chapter-item expanded "><a href="../../client/responding/custom_event_data_with_signals_and_effects_part2.html"><strong aria-hidden="true">30.11.</strong> Custom Event Data with Signals and Effects - Part 2</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">31.</strong> Sending Data</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/responding/forms.html"><strong aria-hidden="true">31.1.</strong> Forms</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">31.2.</strong> Acton Forms</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">32.</strong> Sending and Receiving Data</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">32.1.</strong> Fetch</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">32.2.</strong> Web Socket</div></li></ol></li><li class="chapter-item expanded "><a href="../../client/store_data/summary.html"><strong aria-hidden="true">33.</strong> Saving/Persisting Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../client/store_data/web_storage.html"><strong aria-hidden="true">33.1.</strong> Local Storage</a></li><li class="chapter-item expanded "><a href="../../client/store_data/cookies.html"><strong aria-hidden="true">33.2.</strong> Cookies</a></li><li class="chapter-item expanded "><a href="../../client/store_data/indexeddb.html"><strong aria-hidden="true">33.3.</strong> IndexedDB</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Server Side</li><li class="chapter-item expanded "><a href="../../server/summary.html"><strong aria-hidden="true">34.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">35.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/cargo_leptos/summary.html"><strong aria-hidden="true">35.1.</strong> Cargo Leptos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/cargo_leptos/setup.html"><strong aria-hidden="true">35.1.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/file_structure.html"><strong aria-hidden="true">35.1.2.</strong> File Structure</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/config.html"><strong aria-hidden="true">35.1.3.</strong> Config</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/overview_main.html"><strong aria-hidden="true">35.1.4.</strong> Server Initialization and Main.rs</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/overview_app.html"><strong aria-hidden="true">35.1.5.</strong> Leptos app main component and app.rs</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/leptos_meta.html"><strong aria-hidden="true">35.1.6.</strong> Leptos_meta</a></li><li class="chapter-item expanded "><a href="../../server/cargo_leptos/leptos_router.html"><strong aria-hidden="true">35.1.7.</strong> Leptos_router</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">36.</strong> Introspection and Debugging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.</strong> Responding to Requests</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/responding/get_method_forms.html"><strong aria-hidden="true">37.1.</strong> Get Method Forms</a></li><li class="chapter-item expanded "><a href="../../server/responding/post_method_forms.html"><strong aria-hidden="true">37.2.</strong> Post Method Forms</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.3.</strong> Accessing Request Data</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.</strong> Responding Parts</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.1.</strong> Headers</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.2.</strong> Cookies</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.4.3.</strong> Body</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.5.</strong> HTML Requests - Routes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.6.</strong> Data Requests - Server Functions</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">37.7.</strong> Behaviour Request - Server Actions</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">38.</strong> Client Server Communication</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../server/server_client_communication/server_functions.html" class="active"><strong aria-hidden="true">38.1.</strong> Server Functions</a></li><li class="chapter-item expanded "><a href="../../server/server_client_communication/transition.html"><strong aria-hidden="true">38.2.</strong> &lt;Transition&gt;</a></li><li class="chapter-item expanded "><a href="../../server/server_client_communication/action_form.html"><strong aria-hidden="true">38.3.</strong> &lt;ActionForm&gt;</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">38.4.</strong> Web Sockets</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">39.</strong> Saving/Persisting Data</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Deployment</li><li class="chapter-item expanded "><div><strong aria-hidden="true">40.</strong> Render.com</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">41.</strong> Fly.io</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">42.</strong> Cloudflare Workers</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Desktop Applications</li><li class="chapter-item expanded "><div><strong aria-hidden="true">43.</strong> Tauri</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">44.</strong> TUI</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Tutorial Projects</li><li class="chapter-item expanded "><div><strong aria-hidden="true">45.</strong> Blog</div></li><li class="chapter-item expanded "><a href="../../tutorial_projects/initiative_tracker/summary.html"><strong aria-hidden="true">46.</strong> RPG Initiative Tracker</a></li><li class="chapter-item expanded "><a href="../../tutorial_projects/chat/summary.html"><strong aria-hidden="true">47.</strong> Chat</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Quick Reference</li><li class="chapter-item expanded "><a href="../../quick_reference/rust/structuring_applictions.html"><strong aria-hidden="true">48.</strong> Structuring Applications</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Recipes</li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div><strong aria-hidden="true">49.</strong> Common Application Behaviours</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">49.1.</strong> Form Validation</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">50.</strong> Common Design Patterns</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">50.1.</strong> Event Sourcing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.</strong> Common Problems and Concerns</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">51.1.</strong> Quality</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">51.1.1.</strong> UI Response Time</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.1.2.</strong> Bundle Size</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.1.3.</strong> Partial Hydration</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.2.</strong> Consistency</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">51.2.1.</strong> Offline Support and Data Sync</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.2.2.</strong> Observability and Logging</div></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Building Apps with Rust</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="server-functions"><a class="header" href="#server-functions">Server Functions</a></h1>
<blockquote>
<p><a href="https://docs.rs/leptos_server/0.1.3/leptos_server/">Official <code>leptos_server</code> documentation</a></p>
</blockquote>
<p>A server function is a function that runs on the server. It can perform tasks or return values.</p>
<blockquote>
<p><strong>Design Pattern Aside:</strong> It's often a good idea to separate functions that do something, and functions that return values. This is called a &quot;Command/Query&quot; design pattern.</p>
</blockquote>
<h2 id="isomorphic"><a class="header" href="#isomorphic">Isomorphic</a></h2>
<p>When a server function is <em>called in the context of the <strong>server</strong></em>, it will run as expected. </p>
<p>When a server function is <em>called in the context or from the <strong>client</strong>,</em> it will dispatch a request to the server, which will in turn run the server function on the server. Any returned data will be transparently returned by the original function call on the client, as if it had done the work. The ability to call the same function with these different implementations is why Leptos is considered an <em>Isomorphic</em> framework.</p>
<h2 id="why-though"><a class="header" href="#why-though">Why though?</a></h2>
<p>You may ask, why do we care if we run code on the server or the client? It might feel like e should push as much code to the client as possible so that we don't have a lot of server costs and to cut down on the response time of requesting new data from the server. The answer to this question is always, &quot;it depends.&quot; </p>
<p>There are some things we don't want to do on the client. A lot of these decisions come from the reality that the client is a multipurpose device with variable computational ability (slow) and we can't guarantee that users aren't doing anything sketchy on their clients (untrusted/unreliable).</p>
<p>By using server functions we can move computationally heavy tasks to the server, where they can also be cached. We can also move tasks like requests for data to a place where credentials to access that data are out of reach from the client.</p>
<p>An interesting side effect is that by doing more on the server we can often do the work once, cache it, and then serve it to multiple clients. This allows us to use less total power across our application (server and client) foot print. It may allow us to ship smaller client side applications which also reduces waste. It also allows us to create a quality and inclusive experience for lower power or older devices, encouraging people to keep those devices for longer.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>Server functions are declared by prefixing a function with the <code>#[server()]</code> macro. The server macro's first argument should be the name you're giving to the server function. Here we've called it <code>MyServerFunction</code></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[server(MyServerFunction)]
async fn my_server_fn(cx: Scope) -&gt;Result&lt;(),ServerFnError&gt; {
	println!(&quot;You rang?&quot;);
	Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h3 id="source-function-specifications"><a class="header" href="#source-function-specifications">Source function specifications</a></h3>
<ul>
<li>The functions must be <code>async</code>.</li>
<li>It must have <em>serializable</em> arguments</li>
<li>It must return <code>Result&lt;T, ServerFnError&gt;</code></li>
<li>The Ok returned type <code>T</code> must be <em>serializable</em>. </li>
<li><code>cx: Scope</code> is an optional first parameter but is a snapshot of the scope provided by the server. It does not grant access to the reactive system like it does in components.</li>
</ul>
<h3 id="server-function-naming"><a class="header" href="#server-function-naming">Server function naming</a></h3>
<p>It's important to note that the name of the function <code>my_server_fn</code> and the name of the server function <code>MyServerFunction</code> are different. This allows us to address the prepared server function separately from its source function <code>my_server_fn</code>.</p>
<h3 id="server-function-registration"><a class="header" href="#server-function-registration">Server function registration</a></h3>
<p>We now need to register the server function with Leptos. We do this by calling the <code>register()</code> method on the server function, in the main function. Thankfully we have the name of the server function as a handle to do this.</p>
<pre><pre class="playground"><code class="language-rust">fn main(){
	_ = MyServerFunction::register();
}</code></pre></pre>
<blockquote>
<p>The register method returns a <code>Result&lt;(),ServerFnError&gt;</code>. Rust will complain about the return value of the method call not being handled and requires us to specify that it exists and that we're doing something with it. We assign it to an underscore which tells rust, &quot;We see this assignment and we're explicitly doing nothing with it... but we see it.&quot;</p>
</blockquote>
<h3 id="server-function-dependencies"><a class="header" href="#server-function-dependencies">Server function dependencies</a></h3>
<p>Server functions depend on the ability to serialize data sent from the client to the server function, and to deserialize the result of a server function on its return trip to the client. You will need to add <code>serde</code> to your <code>cargo.toml</code> as the serialization implementation.</p>
<pre><code class="language-toml">serde = {version = &quot;1.0.152&quot;, features = [&quot;derive&quot;] }
</code></pre>
<hr />
<h2 id="calling-server-function"><a class="header" href="#calling-server-function">Calling server function</a></h2>
<p>We previously stated that server functions must be async. But our component functions are synchronous. As you can see, there's a problem here. You can not await an async function inside a synchronous function.</p>
<p>There are two bridges inside Leptos that allow the reactive synchronous system to interact with the asynchronous action system:</p>
<ul>
<li><strong>Resources:</strong> Read values</li>
<li><strong>Actions:</strong> Dispatch side effects.</li>
</ul>
<blockquote>
<p>Resources and Actions can be used to bridge anything into the reactive system. While they're necessary for server functions, they are not limited to server functions.</p>
</blockquote>
<h3 id="reading-data-with-resources"><a class="header" href="#reading-data-with-resources">Reading data with <strong>resources</strong></a></h3>
<blockquote>
<p><a href="https://docs.rs/leptos_reactive/0.1.3/leptos_reactive/struct.Resource.html">Official documentation</a></p>
</blockquote>
<blockquote>
<p>There are some things you will need to do to use data read from resources in your UI. Continue reading after this section for that information.</p>
</blockquote>
<p>A resource is a signal, like any that you've made before, that has its value updated when its <code>source</code> data is updated. This allows the async task to run in the background and update the signal when it's ready, which our reactive system can react to without waiting for it.</p>
<p>A resource is created with the function <code>create_resource</code>, which takes three arguments:</p>
<ul>
<li><code>cx</code> — A scope context in which the resource will exist</li>
<li><code>source</code> — A function that returns the arguments used for the fetcher.</li>
<li><code>fetcher</code> — An async function (Future) which yields the resource's data when done.</li>
</ul>
<h4 id="unary-one-parameter-fetcher-example"><a class="header" href="#unary-one-parameter-fetcher-example">Unary (one parameter) fetcher example</a></h4>
<p>The following example exemplifies setting up a resource for a server function with one parameter. In this case, it is a function that accepts a single  8 bit integer (<code>u8</code>) called <code>some_number</code>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[server(MyServerFunction)]  
async fn my_server_fn(some_number: u8) -&gt; Result&lt;u8, ServerFnError&gt; {
	// stuff happens here
	Ok(42)
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>Note that we need to return <code>Result</code> types from server functions, so we have to wrap our return value in <code>Ok()</code>.</p>
</blockquote>
<p>The first step is to create the signal which contains the arguments used to call the server function.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let default_server_fn_args : u8 = 6;

let (
	my_server_fn_args, 
	set_my_server_fn_args
) = create_signal(
	cx, 
	default_server_fn_args
);

let server_fn_result = create_resource(  
    cx,    
    my_server_fn_args,    // the signal listened to for changes
    my_server_fn          // the fn run with the server args signal value
);
<span class="boring">}</span></code></pre></pre>
<h4 id="resources-for-server-functions-with-no-parameters-or-more-than-one-parameter"><a class="header" href="#resources-for-server-functions-with-no-parameters-or-more-than-one-parameter">Resources for server functions with no parameters or more than one parameter.</a></h4>
<p>Resource <code>fetcher</code>s  allow only one parameter. Signals can only contain one value. These constraints require us to wrap aspects of the resource config in closures so that the signatures (data types) of the arguments matches the expected signatures of the <code>create_resources()</code> function parameters.</p>
<h5 id="no-parameters"><a class="header" href="#no-parameters">No parameters</a></h5>
<p>A signal for a server function that has no parameters can be provided closures for their source and the fetcher can be wrapped in a closure with an unused parameter.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[server(MyServerFunction)]  
async fn my_server_fn() -&gt; Result&lt;u8, ServerFnError&gt; {
	Ok(1) 
}
<span class="boring">}</span></code></pre></pre>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let resource_that_takes_5_secs = create_resource(  
    cx,  
    ||{},    
    |_| my_server_fn()  
);
<span class="boring">}</span></code></pre></pre>
<h5 id="more-than-one-parameter"><a class="header" href="#more-than-one-parameter">More than one parameter</a></h5>
<p>More than one parameter can be achieved by using a tuple which will match the arguments provided, in order, to the server function.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[server(MyServerFunction)]  
async fn my_server_fn(x: u8, y: u8) -&gt; Result&lt;u8, ServerFnError&gt; {
	Ok( x + y ) 
}
<span class="boring">}</span></code></pre></pre>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let default_server_fn_args : (u8, u8) = (46, 2);

let (
	my_server_fn_args, 
	set_my_server_fn_args
) = create_signal(
	cx, 
	default_server_fn_args
);

let server_fn_result = create_resource(  
    cx,    
    my_server_fn_args,          // the signal listened to for changes
    |(x,y)| my_server_fn(x,y)  // Add parens to destructure
);
<span class="boring">}</span></code></pre></pre>
<h3 id="displaying-async-data-in-the-ui-with-suspense"><a class="header" href="#displaying-async-data-in-the-ui-with-suspense">Displaying async data in the UI with <code>&lt;Suspense&gt;</code></a></h3>
<blockquote>
<p><a href="https://docs.rs/leptos/latest/leptos/fn.Suspense.html">Official documentation</a></p>
</blockquote>
<p>The UI system won't know to wait for new UI data. Leptos has a special component called a <code>&lt;Suspense&gt;</code> component which will wrap use of our resources (signals tied into async values). Failure to do this results in a common error when working with resources through non-suspense wrapped UI. You can almost think of suspense as an automatically awaiting and resolving UI Future.</p>
<blockquote>
<p><strong>Common Error:</strong> &quot;You’re trying to update a <code>Signal&lt;usize&gt;</code> that has already been disposed of. This is probably either a logic error in a component that creates and disposes of scopes, or a Resource resolving after its scope has been dropped without having been cleaned up.&quot;</p>
</blockquote>
<p>Suspense has two different states:</p>
<ul>
<li><strong>Fallback/Pending:</strong> If any signals used in the children have <em>unresolved resources,</em> a fallback view will be displayed via the <code>fallback</code> property on the <code>Suspense</code> component tag.</li>
<li><strong>Resolved:</strong> If <em>all resources are resolved,</em> the children of the <code>Suspense</code> component will be displayed.</li>
</ul>
<p>The syntax is as follows:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let resource_that_takes_5_secs = create_resource(  
	cx,                  // our scope/context   
    ||{},                // a closure that returns fetcher params
    |_| wait_5_seconds() // a closure for the fetcher, which as no params 
);

view!{cx,  
    &lt;Suspense fallback=||&quot;Loading...&quot;.to_string()&gt;  
        { move || resource_that_takes_5_secs.read() }  
        &quot;Loaded&quot;  
    &lt;/Suspense&gt;  
}
<span class="boring">}</span></code></pre></pre>
<p>Above we created a <code>&lt;Suspense&gt;</code> container with a fallback closure. The closure must return an <code>impl IntoView</code>. Strings support IntoView, as do results of the <code>view!</code> macro. Then we move the resource into a block that can be re-run (a closure), calling <code>read()</code> on it. This hooks the resource into the suspense. The rule is, if a resource is used in the suspense, then the suspense must wait for the resources to all be available before it renders its children.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn wait_5_seconds() {  
    futures_timer::Delay::new(Duration::from_secs(5)).await;  
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>We use the <code>futures_timer</code> crate (installed with <code>cargo add futures_timer</code>) so that we get proper async waiting. If we used <code>thread::sleep(Duration::from_secs(5))</code> we'd end up with errors and the whole application would be pausing synchronously.</p>
</blockquote>
<h3 id="writing-data-or-dispatching-side-effects-with-actions"><a class="header" href="#writing-data-or-dispatching-side-effects-with-actions">Writing data or dispatching side effects with <strong>actions</strong></a></h3>
<blockquote>
<p><a href="https://docs.rs/leptos/latest/leptos/struct.Action.html"><code>Action</code> Official Documentation</a>
<a href="https://docs.rs/leptos/latest/leptos/fn.create_action.html"><code>create_action</code> Official Documentation</a></p>
</blockquote>
<p>Actions allow us to make async calls in our synchronous reactive system. We can use actions to make server function calls by calling them an action's task.</p>
<p>Actions are created with the <code>create_action</code> function which accepts two arguments:</p>
<ul>
<li><code>cx</code> — A scope context in which the action will be run</li>
<li><code>task</code> — A function to run asynchronously. Arguments should always be passed by reference</li>
</ul>
<p>An actions tasks is triggered by calling the <code>dispatch</code> method on the <code>Action</code>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[server(MyServerFunction)]  
async fn my_server_fn(x: u8, y: u8) -&gt; Result&lt;u8, ServerFnError&gt; {
	Ok( x + y ) 
}
<span class="boring">}</span></code></pre></pre>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let my_action = create_action(cx, |&amp;(x: u8,y: u8)| {
  my_server_fn(x,y)
}

let my_action_task_args = (46,2);
my_action.dispatch( my_action_task_args );
<span class="boring">}</span></code></pre></pre>
<p>Actions have a few handy methods we can call on them aside from dispatch:</p>
<ul>
<li><code>input</code> — the argument currently running</li>
<li><code>pending</code> — whether the call is pending</li>
<li><code>value</code> — the most recent returned result</li>
<li><code>version</code> — how many times the action has run. Useful for reactively updating something else in response to a <code>dispatch</code> and response</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../server/responding/post_method_forms.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../server/server_client_communication/transition.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../server/responding/post_method_forms.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../server/server_client_communication/transition.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
